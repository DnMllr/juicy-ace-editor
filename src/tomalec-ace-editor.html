<!-- <script src="../../ace/build/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script> -->
<script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js" type="text/javascript" charset="utf-8"></script>

<template>
    <style>
        :host{
            display: block;
        }
        ::content #tomalec-ace-editor-container{
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
    <content></content>
</template>
<script>
(function(window, document, undefined) {
    // Refers to the "importer", which is index.html
    var thatDoc = document;

    // Refers to the "importee", which is src/tomalec-ace-editor.html
    var thisDoc = document._currentScript.ownerDocument;

    // Gets content from <template>
    var template = thisDoc.querySelector('template').content;

    // Creates an object based in the HTML Element prototype
    var TomalecAceEditorPrototype = Object.create(HTMLElement.prototype);

    // Fires when an instance of the element is created
    TomalecAceEditorPrototype.createdCallback = function() {
        // Creates the shadow root
        var shadowRoot = this.createShadowRoot();

        // Adds a template clone into shadow root
        var clone = thatDoc.importNode(template, true);
        shadowRoot.appendChild(clone);
    };

    // Fires when an instance was inserted into the document
    TomalecAceEditorPrototype.attachedCallback = function() {

        var container = document.createElement("div");
            container.id = "tomalec-ace-editor-container";
        // shadowRoot.appendChild(container);
        // Workaround as CSS styles are added to main document, and does not cross Shadow DOM boundry
            container.innerHTML = this.innerHTML;
            this.innerHTML = "";
            this.appendChild(container);

        var editor = ace.edit(container);
        // initial attributes
            editor.setTheme( this.getAttribute("theme") );
            editor.getSession().setMode( this.getAttribute("mode") );
            editor.setFontSize( this.getAttribute("fontsize") );


        this.editor = editor;
    };

    // Fires when an instance was removed from the document
    // TomalecAceEditorPrototype.detachedCallback = function() {};

    // Fires when an attribute was added, removed, or updated
    TomalecAceEditorPrototype.attributeChangedCallback = function(attr, oldVal, newVal) {
        switch(attr){
            case "theme":
                this.editor.setTheme( newVal );
                break;
            case "mode":
                this.editor.getSession().setTheme && this.editor.getSession().setTheme( newVal );
                break;
            case "fontsize":
                this.editor.setFontSize( newVal );
                break;

        }
    };

    document.registerElement('tomalec-ace-editor', {
        prototype: TomalecAceEditorPrototype
    });
}(window, document));
</script>
